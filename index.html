<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>贪吃蛇小游戏</title>

<!-- 广告 SDK 脚本（确保已正确加载） -->
<script src='//libtl.com/sdk.js' data-zone='9787973' data-sdk='show_9787973'></script>

<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    margin-bottom: 10px;
  }

  #gameCanvas {
    border: 2px solid #333;
    background-color: #fff;
  }

  #controls {
    margin-top: 15px;
  }
  button {
    padding: 10px 20px;
    margin: 0 5px;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>贪吃蛇小游戏</h1>
<canvas id="gameCanvas" width="300" height="300"></canvas>

<div id="controls">
  <button onclick="startGame()">开始游戏</button>
  <button onclick="pauseGame()">暂停</button>
  <button onclick="showRewardedInterstitial()">观看奖励广告</button>
  <button onclick="showRewardedPopup()">奖励弹窗广告</button>
  <button onclick="showInApp()">插屏广告</button>
</div>

<script>
  // 等待 SDK 脚本加载完毕
  function waitForSdk(callback) {
    if (typeof show_9787973 === 'function') {
      callback();
    } else {
      setTimeout(() => waitForSdk(callback), 100);
    }
  }

  // 广告调用封装
  function showRewardedInterstitial() {
    waitForSdk(() => {
      show_9787973().then(() => {
        alert('你已观看奖励广告！');
      }).catch(e => {
        console.log('广告播放失败:', e);
      });
    });
  }

  function showRewardedPopup() {
    waitForSdk(() => {
      show_9787973('pop').then(() => {
        alert('奖励弹窗广告已观看！');
      }).catch(e => {
        console.log('广告播放失败:', e);
      });
    });
  }

  function showInApp() {
    waitForSdk(() => {
      show_9787973({
        type: 'inApp',
        inAppSettings: {
          frequency: 2,
          capping: 0.1,
          interval: 30,
          timeout: 5,
          everyPage: false
        }
      });
    });
  }

  // 贪吃蛇游戏代码
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const gridSize = 20;
  const tileCount = canvas.width / gridSize;

  let snake = [{x: 10, y: 10}];
  let dx = 0;
  let dy = 0;
  let food = {x: 0, y: 0};
  let gameInterval = null;

  function getRandomFoodPosition() {
    let x, y;
    do {
      x = Math.floor(Math.random() * tileCount);
      y = Math.floor(Math.random() * tileCount);
    } while (snake.some(segment => segment.x === x && segment.y === y));
    return {x, y};
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 画蛇
    ctx.fillStyle = 'green';
    snake.forEach(segment => {
      ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
    });

    // 画食物
    ctx.fillStyle = 'red';
    ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);
  }

  function moveSnake() {
    const head = {...snake[0]};
    head.x += dx;
    head.y += dy;

    // 撞墙或自己
    if (
      head.x < 0 || head.x >= tileCount ||
      head.y < 0 || head.y >= tileCount ||
      snake.some(segment => segment.x === head.x && segment.y === head.y)
    ) {
      alert('游戏结束！');
      clearInterval(gameInterval);
      return;
    }

    snake.unshift(head);

    if (head.x === food.x && head.y === food.y) {
      // 吃到食物
      food = getRandomFoodPosition();
    } else {
      snake.pop();
    }

    draw();
  }

  function changeDirection(e) {
    const key = e.key;
    if (key === 'ArrowUp' && dy === 0) {
      dx = 0;
      dy = -1;
    } else if (key === 'ArrowDown' && dy === 0) {
      dx = 0;
      dy = 1;
    } else if (key === 'ArrowLeft' && dx === 0) {
      dx = -1;
      dy = 0;
    } else if (key === 'ArrowRight' && dx === 0) {
      dx = 1;
      dy = 0;
    }
  }

  function startGame() {
    if (gameInterval) clearInterval(gameInterval);
    snake = [{x: 10, y: 10}];
    dx = 1;
    dy = 0;
    food = getRandomFoodPosition();
    gameInterval = setInterval(moveSnake, 200);
  }

  function pauseGame() {
    if (gameInterval) {
      clearInterval(gameInterval);
      gameInterval = null;
    }
  }

  document.addEventListener('keydown', changeDirection);
</script>

</body>
</html>
